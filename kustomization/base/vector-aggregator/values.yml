---
fullnameOverride: aggregator
role: Aggregator

affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      # Seperate aggregator pods so if a host goes down, the service doesn't go down.
      - podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: app.kubernetes.io/instance
                operator: In
                values:
                  - vector-aggregator
          topologyKey: kubernetes.io/hostname
        weight: 100

autoscaling:
  enabled: yes
  minReplicas: 1

customConfig:
  # API is enabled for the liveness probe.
  api:
    enabled: yes
    address: 127.0.0.1:8686
    playground: no
  data_dir: /vector-data-dir
  sinks:
    prom_exporter:
      address: 0.0.0.0:9090
      inputs:
        - internal_metrics
        - vector
      type: prometheus_exporter
  sources:
    internal_metrics:
      type: internal_metrics
    vector:
      address: 0.0.0.0:6000
      type: vector
      version: "2"

image:
  repository: timberio/vector
  tag: 0.32.1-distroless-libc

serviceHeadless:
  enabled: no
