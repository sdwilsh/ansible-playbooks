---
apiVersion: acid.zalan.do/v1
kind: postgresql
metadata:
  name: paperless-pg 
spec:
  additionalVolumes:
    - mountPath: /etc/vector
      name: vector-config
      targetContainers:
        - vector
      volumeSource:
        projected:
          defaultMode: 420
          sources:
            - configMap:
                name: postgresql-vector-metrics-sidecar-config
    - mountPath: /vector-data-dir
      name: vector-data
      targetContainers:
        - vector
      volumeSource:
        emptyDir: {}
  teamId: paperless
  volume:
    size: 20Gi
    storageClass: longhorn-encrypted
  numberOfInstances: 2
  podPriorityClassName: critical-application-infra
  postgresql:
    version: "15"
  preparedDatabases:
    paperless:
      defaultUsers: true
      schemas:
        public: {}
  sidecars:
    - image: timberio/vector:0.39.0-distroless-libc
      name: vector
      securityContext:
        allowPrivilegeEscalation: false
        capabilities:
          drop:
            - ALL
        runAsNonRoot: false
        seccompProfile:
          type: RuntimeDefault
