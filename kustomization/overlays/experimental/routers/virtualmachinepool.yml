---
apiVersion: pool.kubevirt.io/v1alpha1
kind: VirtualMachinePool
metadata:
  name: vyos-work
spec:
  replicas: 2
  selector:
    matchLabels:
      app.kubernetes.io/name: vyos-work
  virtualMachineTemplate:
    metadata:
      labels:
        app.kubernetes.io/name: vyos-work
    spec:
      dataVolumeTemplates:
        - metadata:
            name: vyos-work-disk
          spec:
            source:
              blank: {}
            storage:
              resources:
                requests:
                  storage: 10Gi
              storageClassName: longhorn-encrypted
              volumeMode: Filesystem # Block storage didn't seem to ever provision.
      running: true
      template:
        metadata:
          labels:
            app.kubernetes.io/name: vyos-work
        spec:
          affinity:
            podAntiAffinity:
              requiredDuringSchedulingIgnoredDuringExecution:
                - labelSelector:
                    matchExpressions:
                      - key: app.kubernetes.io/name
                        operator: In
                        values:
                          - vyos-work
                  topologyKey: kubernetes.io/hostname
          domain:
            cpu:
              cores: 1
              threads: 2
            devices:
              autoattachPodInterface: false
              disks:
                - name: disk
                  disk:
                    bus: virtio
                  bootOrder: 2
                - name: install
                  cdrom:
                    bus: sata
                  bootOrder: 1
              interfaces:
                - name: trunk
                  bridge: {}
            resources:
              requests:
                memory: 1Gi
          networks:
            - name: trunk
              multus:
                networkName: trunk
          priorityClassName: critical-application-infra
          terminationGracePeriodSeconds: 120
          volumes:
            - dataVolume:
                name: vyos-work-disk
              name: disk
            - name: install
              persistentVolumeClaim:
                claimName: vyos-1.5-rolling-202409060006-generic-amd64
