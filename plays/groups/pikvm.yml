- name: Mount the filesystem as rw
  hosts: pikvm
  gather_facts: no
  tasks:
    - name: Mount the filesystem as rw
      ansible.builtin.raw: rw
      changed_when: no
- name: Configure PiKVM Devices 
  hosts: pikvm
  gather_facts: yes
  tasks:
    - name: Deploy public keys to root user
      ansible.posix.authorized_key:
        user: root
        state: present
        key: "{{ item.type }} {{ item.key }}"
      loop: "{{ common__keys }}"
      loop_control:
        label: "{{ item.description }}"
      tags:
        - ssh
    - name: Configure timesyncd
      ansible.builtin.copy:
        content: |
          [Time]
          NTP=pool.ntp.hogs.tswn.us
        dest: /etc/systemd/timesyncd.conf
        mode: u=r,g=r,o=r
        owner: root
        group: root
      tags:
        - ntp
        - timesyncd
    - name: Set timezone to US/Pacific
      community.general.timezone:
        name: US/Pacific
      tags:
        - timedatectl
  post_tasks:
    - name: Mount the filesystem as ro
      ansible.builtin.raw: ro
      changed_when: no
