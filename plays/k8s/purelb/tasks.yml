---
- name: Create a namespace for PureLB
  kubernetes.core.k8s:
    api_version: v1
    context: "{{ cluster }}"
    kind: Namespace
    name: purelb
- name: Install PureLB via Helm
  kubernetes.core.k8s:
    api_version: helm.cattle.io/v1
    context: "{{ cluster }}"
    kind: HelmChart
    resource_definition:
      metadata:
        name: purelb
        namespace: purelb
      spec:
        chart: purelb
        repo: https://gitlab.com/api/v4/projects/20400619/packages/helm/stable
        version: "0.7.0"
- name: Setup default (MAN) service pool
  kubernetes.core.k8s:
    api_version: purelb.io/v1
    context: "{{ cluster }}"
    kind: ServiceGroup
    resource_definition:
      metadata:
        name: default
        namespace: purelb
      spec:
        local:
          v4pool:
            aggregation: default
            pool: 10.10.0.150-10.10.0.174
            subnet: 10.10.0.0/24
