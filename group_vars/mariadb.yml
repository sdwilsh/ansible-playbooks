---

common__zfs_dataset_keys:
  mariadb:
    mariadb-data:
      key: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          33366239646466363436623632323831616130303737623065616234643030343338653031643238
          3236346635383937366434353034323338343934306330360a626138616638303530366231316439
          61653362636262343633353439303137363262656336323261376466323663306632653630656337
          3963383436333964310a393330303633346163376537306632363735343734643831346438373635
          62383166653639353038656139616632643430326633656664326661373666633339343336633635
          38313630383566333931663237373065353932666236653861326162383363393866316331616131
          62386366313966646132323837656430326266333230646632653332343431303035313362336534
          66653465323963663961
    mariadb-logs:
      key: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          39633366643964383631346136303036666539306130646438356634303633316637623732316663
          3034393835326365666464646266626264613865363330380a376133656133336262343734633064
          30386463336339356639643663326637633864366639663263346130303230356232373866373730
          3534383438383865340a633732363435313438343130313465303764656264333964393761343237
          36663636323863643666363766396162636336323338383630383238663331636630303731346234
          65323238353433383665383666366263323931316466653763326530373861663262373365323566
          35663131363662363431666134303164663539633231613031613337663661636136633733323365
          38353661636162393537

# mrlesmithjr.mariadb_galera_cluster
galera_cluster_bind_address: "{{ common__ip_addresses | ansible.utils.ipv4 | ansible.utils.ipaddr('address') | first }}"
galera_cluster_bind_interface: "{{ common__ethernet_primary_interface }}"
galera_cluster_name: hogs
galera_cluster_nodes_group: mariadb
mariadb_config_overrides:
  mysqld:
      datadir: /var/lib/mysql/data
      innodb_doublewrite: 0 # ZFS protects us already.
      innodb_log_group_home_dir: /var/lib/mysql/logs
mariadb_mysql_root_password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          33633361643462643162353732353234356436663065333936616562336538333136363431373130
          3762653261653536306336373839653534383965393862330a653165316661356164313530623438
          66666634613039363131636332386134353633383865303139663966386439303938633362623535
          6262333738393131360a643438636262326631643762656332393839393533653263373165366435
          33653461393132376137376134626531343066303861363366356437313133336435346330373761
          39363837633534363439636233373062363834343338376164323434343032323361303337303035
          33343065663863376462343233653433353939663062376234363334666634306433313231356439
          32313537616431633661646466613664303235313738323235633136343036336465333436666539
          34663634633037616465366539336261386138613066663834623436353630356263
mariadb_version: "10.10"

# mrlesmithjr.zfs
zfs_create_pools: yes
zfs_create_filesystems: yes
zfs_filesystems:
  - name: mariadb-data
    encryption: aes-256-gcm
    group: mysql
    keyformat: hex
    keylocation: file:///usr/local/etc/zfs/keys/mariadb/datasets/mariadb-data
    mountpoint: /var/lib/mysql/data
    owner: mysql
    pool: mariadb
    state: present
  - name: mariadb-logs
    encryption: aes-256-gcm
    group: mysql
    keyformat: hex
    keylocation: file:///usr/local/etc/zfs/keys/mariadb/datasets/mariadb-logs
    mountpoint: /var/lib/mysql/logs
    owner: mysql
    pool: mariadb
    state: present
zfs_manage_filesystem_permissions: yes
zfs_pools:
  - name: mariadb
    action: create
    atime: off
    compression: zstd
    devices:
      - /dev/disk/by-path/pci-0000:02:00.0-scsi-0:0:1:0
    # While InnoDB has 16K pages, this is running on a VMDK disk which uses a block size of 1M.
    recordsize: 1048576 # 1M
    state: present
    type: basic
