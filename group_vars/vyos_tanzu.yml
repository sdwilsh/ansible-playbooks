---
vyos_dns_forwarding__allow_from:
  - 10.95.0.0/23
  - 10.96.0.0/23
vyos_dns_forwarding__listen_addresses:
  # TANZU-MAN
  - 10.95.0.1
  - "10.95.0.{{ vyos__host_id_ipv4 }}"
  # TANZU-WORK
  - 10.96.0.1
  - "10.96.0.{{ vyos__host_id_ipv4 }}"

vyos_firewall__zones:
  - name: LOCAL
    local-zone: True
  - name: MAN
    description: "management vlan ({{ ansible_managed }})"
    interfaces:
      - eth1.10
  - name: TANZU-MAN
    description: Tanzu Management Network
    interfaces:
      - eth1.95
  - name: TANZU-WORK
    description: Tanzu Workload Network
    interfaces:
      - eth1.96
  - name: TRANSIT
    description: "Transit between local routers ({{ ansible_managed }})"
    interfaces:
      - eth0
  - name: SYNC
    description: "Synchronization traffic (like VRRP, DHCP, etc) ({{ ansible_managed }})"
    interfaces:
      - eth1.9
vyos_firewall__zones_path: ./firewall_zones/vyos_tanzu

vyos_firewall_global__group:
  address_group:
    - name: FILE-SERVER-v4
      description: IP Addresses for the NFS Server
      afi: ipv4
      members:
        # firstlightweaveslivingsong.hogs.tswn.us
        - address: 10.117.0.10
    - name: NTP-SERVICES-v4
      description: NTP Hosts
      members:
        - address: 10.117.0.50
    - name: PEER-v4
      description: IP Addresses of our Peer Router ({{ ansible_managed }})
      afi: ipv4
      members:
        - address: "10.2.0.{{ vyos__peer_host_id_ipv4 }}"
        - address: "10.9.0.{{ vyos__peer_host_id_ipv4 }}"
        - address: "10.10.0.{{ vyos__peer_host_id_ipv4 }}"
        - address: "10.95.0.{{ vyos__peer_host_id_ipv4 }}"
        - address: "10.96.0.{{ vyos__peer_host_id_ipv4 }}"
    - name: SERVICE-TALKERS-v4
      description: IP Addresses allowed to talk to services
      members:
        # sdwilsh-dev.hogs.tswn.us (sdwilsh-dev)
        - address: 10.10.0.20
        # lighterthansome.hogs.tswn.us (sdwilsh-laptop)
        - address: 10.117.0.9
        # sdwilsh-desktop
        - address: 10.117.0.31
    - name: TANZU-SUP-v4
      description: vCenter Tanzu Supervisor IP Addresses
      afi: ipv4
      members:
        - address: 10.95.0.10
        - address: 10.95.0.11
        - address: 10.95.0.12
        - address: 10.95.0.13
    - name: VCENTER-v4
      description: vCenter IP Addresses
      afi: ipv4
      members:
        - address: 10.10.0.5
  network_group:
    - name: RFC1918-v4
      description: "IPv4 Private Address Space ({{ ansible_managed }})"
      members:
        - address: 192.168.0.0/16
        - address: 172.16.0.0/12
        - address: 10.0.0.0/8
  port_group:
    - name: DNS
      members:
        - port: 53
    - name: NFS
      members:
        - port: 111
        - port: 674
        - port: 2049
    - name: NTP
      members:
        - port: 123

vyos_interfaces__ethernet:
  - name: eth0
    description: TRANSIT - router-to-router traffic
    ipv4:
      - address: "10.2.0.{{ vyos__host_id_ipv4 }}/24"
  - name: eth1
    description: Trunk
    vifs:
      - vlan_id: 9
        description: SYNC - used for router synchronization communication
        ipv4:
          - address: "10.9.0.{{ vyos__host_id_ipv4 }}/24"
      - vlan_id: 10
        description: MAN - management vlan
        ipv4:
          - address: "10.10.0.{{ vyos__host_id_ipv4 }}/24"
      - vlan_id: 95
        description: Tanzu Management Network
        ipv4:
          - address: "10.95.0.{{ vyos__host_id_ipv4 }}/23"
      - vlan_id: 96
        description: Tanzu Workload Network
        ipv4:
          - address: "10.96.0.{{ vyos__host_id_ipv4 }}/23"

vyos_static_routes__config:
  - address_families:
    - afi: ipv4
      routes:
        - dest: 0.0.0.0/0
          next_hops:
            - forward_router_address: 10.2.0.70
        - dest: 10.117.0.0/23
          next_hops:
            - forward_router_address: 10.2.0.72

# This uses a local DNS forwarding server, so use that.
vyos_system__name_servers:
  - 127.0.0.1

vyos_vrrp__conntrack_sync:
  interface: eth1.9
  peer_address: "10.9.0.{{ vyos__peer_host_id_ipv4 }}"
  sync_group: MAIN
vyos_vrrp__groups:
  - hello_source_address: "10.2.0.{{ vyos__host_id_ipv4 }}"
    interface: eth0
    name: TRANSIT-v4
    peer_address: "10.2.0.{{ vyos__peer_host_id_ipv4 }}"
    priority: "{{ vyos__vrrp_priority }}"
    sync_group: MAIN
    virtual_address: 10.2.0.75/24
    vrid: 2
  - hello_source_address: "10.95.0.{{ vyos__host_id_ipv4 }}"
    interface: eth1.95
    name: TANZU-MAN-v4
    peer_address: "10.95.0.{{ vyos__peer_host_id_ipv4 }}"
    priority: "{{ vyos__vrrp_priority }}"
    sync_group: MAIN
    virtual_address: 10.95.0.1/23
    vrid: 95
  - hello_source_address: "10.96.0.{{ vyos__host_id_ipv4 }}"
    interface: eth1.96
    name: TANZU-WORK-v4
    peer_address: "10.96.0.{{ vyos__peer_host_id_ipv4 }}"
    priority: "{{ vyos__vrrp_priority }}"
    sync_group: MAIN
    virtual_address: 10.96.0.1/23
    vrid: 96
