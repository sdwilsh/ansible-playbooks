---
vyos_dns_forwarding__allow_from:
  - 127.0.0.0/8
vyos_dns_forwarding__domain_servers:
  - domain: 0.10.10.in-addr.arpa
    servers:
      - 10.10.0.1
  - domain: 0.117.10.in-addr.arpa
    servers:
      - 10.10.0.1
  - domain: hogs.tswn.us
    servers:
      - 10.10.0.1
vyos_dns_forwarding__listen_addresses:
  - 127.0.0.1
vyos_dns_forwarding__name_servers:
  # https://www.vultr.com/docs/vultr-dns-servers
  - 108.61.10.10
  - 2001:19f0:300:1704::6

vyos__ssh_address_ipv4: 149.248.37.12

vyos_firewall_global__group:
  address_group:
    - name: UNIFI-v4
      description: The v4 address of the Unifi Controller
      afi: ipv4
      members:
        - address: 10.82.0.2
  port_group:
    - name: UNIFI-DEVICE-TCP
      description: Ports used by the Unifi Controller to talk to devices over TCP
      members:
        - port: 8080
    - name: UNIFI-DEVICE-UDP
      description: Ports used by the Unifi Controller to talk to devices over UDP
      members:
        - port: 3478

vyos_firewall__zones:
  - name: CLOUD
    interfaces:
      - wg3
      - wg4
  - name: "LOCAL"
    local-zone: yes
  - name: "MACCABEUS"
    interfaces:
      - "wg0"
      - "wg1"
  - name: "MOBILE"
    interfaces:
      - "wg2"
  - name: "WAN"
    interfaces:
      - "eth0"
vyos_firewall__zones_root_path: firewall_zones/vyos_remote

vyos_interfaces__ethernet:
  - name: "eth0"
    description: "WAN"
    enabled: true
    ipv4:
      - address: "149.248.37.12/23"

vyos_interfaces__wireguard:
  - name: "wg0"
    description: "maccabeus01 site-to-site"
    ipv4:
      - address: "10.10.1.2/30"
    mtu: "1280"
    peers:
      - name: "maccabeus01"
        allowed_ips:
          ipv4:
            - network: "0.0.0.0/0"
            - network: "10.117.0.0/23"
            - network: "10.10.1.1/32"
        persistent_keepalive_sec: "15"
        pubkey: "{{ hostvars['maccabeus01.hogs.tswn.us'].wireguard__pubkey }}"
    port: "51820"
  - name: "wg1"
    description: "maccabeus02 site-to-site"
    ipv4:
      - address: "10.10.1.6/30"
    mtu: "1280"
    peers:
      - name: "maccabeus02"
        allowed_ips:
          ipv4:
            - network: "0.0.0.0/0"
            - network: "10.117.0.0/23"
            - network: "10.10.1.5/32"
        persistent_keepalive_sec: "15"
        pubkey: "{{ hostvars['maccabeus02.hogs.tswn.us'].wireguard__pubkey }}"
    port: "51821"
  - name: "wg2"
    description: "mobile devices vpn"
    ipv4:
      - address: "10.117.2.1/24"
    peers:
      - name: "sdwilsh-phone"
        allowed_ips:
          ipv4:
            - network: "10.117.2.10/32"
        pubkey: "tPhu26d+Maw1P/ksdNA995PsTmqnpmjzwiTHe2t36ms="
      - name: "sdwilsh-pixel6a"
        allowed_ips:
          ipv4:
            - network: "10.117.2.11/32"
        pubkey: "bj66TS/e9M1mbHvmc8JCbMR2t2ziEJ6tipyfBnYdJCE="
      - name: "mango"
        allowed_ips:
          ipv4:
            - network: "10.117.2.12/32"
        pubkey: "dPKLI79wCJyq5kWvU7hqkixcTWBB2xhBhv46g8088Hw="
    port: "51822"
  - name: wg3
    description: cloud01.routers.hogs.tswn.us wg0
    ipv4:
      - address: 10.2.1.2/30
    mtu: "{{ hostvars['cloud01.routers.hogs.tswn.us'].vyos_interfaces__wireguard | selectattr('name', 'eq', 'wg0') | map(attribute='mtu') | first}}"
    peers:
      - name: cloud01.routers.hogs.tswn.us
        allowed_ips:
          ipv4:
            # cloud01.routers.hogs.tswn.us
            - network: 10.2.1.1/32
            # Service Networks to Tunnel
            - network: 10.82.0.0/24
            # Allow OSPF
            - network: 224.0.0.5/32
            - network: 224.0.0.6/32
        persistent_keepalive_sec: 15
        pubkey: "{{ hostvars['cloud01.routers.hogs.tswn.us'].wireguard__pubkey }}"
    port: 51823
  - name: wg4
    description: cloud02.routers.hogs.tswn.us wg0
    ipv4:
      - address: 10.2.1.6/30
    mtu: "{{ hostvars['cloud02.routers.hogs.tswn.us'].vyos_interfaces__wireguard | selectattr('name', 'eq', 'wg0') | map(attribute='mtu') | first}}"
    peers:
      - name: cloud02.routers.hogs.tswn.us
        allowed_ips:
          ipv4:
            # cloud02.routers.hogs.tswn.us
            - network: 10.2.1.5/32
            # Service Networks to Tunnel
            - network: 10.82.0.0/24
            # Allow OSPF
            - network: 224.0.0.5/32
            - network: 224.0.0.6/32
        persistent_keepalive_sec: 15
        pubkey: "{{ hostvars['cloud02.routers.hogs.tswn.us'].wireguard__pubkey }}"
    port: 51824

vyos_ospf_interfaces__config:
  - name: "wg0"
    address_family:
    - afi: "ipv4"
      authentication:
        md5_key:
          key_id: 1
          key: "{{ vyos__ospf_authentication_key }}"
      cost: 10 # 1G
      dead_interval: 5
      hello_interval: 2
      network: "point-to-point"
      priority: "{{ hostvars['maccabeus01.hogs.tswn.us'].vyos__vrrp_priority }}"
  - name: "wg1"
    address_family:
    - afi: "ipv4"
      authentication:
        md5_key:
          key_id: 1
          key: "{{ vyos__ospf_authentication_key }}"
      cost: 10 # 1G
      dead_interval: 5
      hello_interval: 2
      network: "point-to-point"
      priority: "{{ hostvars['maccabeus02.hogs.tswn.us'].vyos__vrrp_priority }}"
  - name: wg3
    address_family:
    - afi: ipv4
      authentication:
        md5_key:
          key_id: 1
          key: "{{ vyos__ospf_authentication_key }}"
      cost: 10 # 1G
      dead_interval: 5
      hello_interval: 2
      network: point-to-point
      priority: "{{ hostvars['cloud01.routers.hogs.tswn.us'].vyos__vrrp_priority }}"
  - name: wg4
    address_family:
    - afi: ipv4
      authentication:
        md5_key:
          key_id: 1
          key: "{{ vyos__ospf_authentication_key }}"
      cost: 10 # 1G
      dead_interval: 5
      hello_interval: 2
      network: point-to-point
      priority: "{{ hostvars['cloud02.routers.hogs.tswn.us'].vyos__vrrp_priority }}"

vyos_ospfv2__neighbors:
  - neighbor_id: 10.2.1.1
    priority: "{{ hostvars['cloud01.routers.hogs.tswn.us'].vyos__vrrp_priority }}"
  - neighbor_id: 10.2.1.5
    priority: "{{ hostvars['cloud02.routers.hogs.tswn.us'].vyos__vrrp_priority }}"
  - neighbor_id: "10.10.1.1"
    priority: "{{ hostvars['maccabeus01.hogs.tswn.us'].vyos__vrrp_priority }}"
  - neighbor_id: "10.10.1.5"
    priority: "{{ hostvars['maccabeus02.hogs.tswn.us'].vyos__vrrp_priority }}"

vyos_ospfv2_parameters__router_id: "149.248.37.12"

vyos_static_routes__config:
  - address_families:
    - afi: ipv4
      routes:
        - dest: 0.0.0.0/0
          next_hops:
            - forward_router_address: 149.248.36.1

# This uses a local DNS forwarding server, so use that.
vyos_system__name_servers:
  - "127.0.0.1"

wireguard__pubkey: "Dwdz7rWR4y8uMW3s4MWZwe1+rR0Bqiigms7Aku51ghU="
